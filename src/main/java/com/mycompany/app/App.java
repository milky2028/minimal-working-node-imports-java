package com.mycompany.app;

import java.util.Arrays;
import org.graalvm.polyglot.*;
import org.graalvm.polyglot.proxy.ProxyArray;

/**
 * Simple benchmark for Graal.js via GraalVM Polyglot Context and ScriptEngine.
 */
public class App {
    public static void main(String[] args) {
        Context context = Context.create("js");
        Value jsBindings = context.getBindings("js");
        context.eval("js", "var exports = {}");
        context.eval("js",
                "!function(r,e){for(var t in e)r[t]=e[t]}(exports,function(r){var e={};function t(n){if(e[n])return e[n].exports;var o=e[n]={i:n,l:!1,exports:{}};return r[n].call(o.exports,o,o.exports,t),o.l=!0,o.exports}return t.m=r,t.c=e,t.d=function(r,e,n){t.o(r,e)||Object.defineProperty(r,e,{enumerable:!0,get:n})},t.r=function(r){'undefined'!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(r,Symbol.toStringTag,{value:'Module'}),Object.defineProperty(r,'__esModule',{value:!0})},t.t=function(r,e){if(1&e&&(r=t(r)),8&e)return r;if(4&e&&'object'==typeof r&&r&&r.__esModule)return r;var n=Object.create(null);if(t.r(n),Object.defineProperty(n,'default',{enumerable:!0,value:r}),2&e&&'string'!=typeof r)for(var o in r)t.d(n,o,function(e){return r[e]}.bind(null,o));return n},t.n=function(r){var e=r&&r.__esModule?function(){return r.default}:function(){return r};return t.d(e,'a',e),e},t.o=function(r,e){return Object.prototype.hasOwnProperty.call(r,e)},t.p='',t(t.s=0)}([function(r,e,t){'use strict';function n(r,e){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)throw new Error('invalid inputs for weighted average');let t=0,n=0;for(let o=0;o<r.length;o++)null!==r[o]&&null!==e[o]&&0!==r[o]&&(t+=r[o]*e[o],n+=r[o]);return t/n}function o(r,e,t){const n=new Map;for(let o=0;o<r.length;o++){const i=e[o],l=t[o];let a=n.get(i);void 0===a&&(a=new Map,n.set(i,a));let s=a.get(l);void 0===s&&(s=[],a.set(l,s)),s.push(r[o])}return n}function i(r,e){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length)throw new Error('invalid inputs for dispersion');const t=n(r,e);let o=0,i=0;for(let n=0;n<r.length;n++)null!==r[n]&&null!==e[n]&&0!==r[n]&&0!==e[n]&&(o+=r[n]*Math.abs(e[n]-t),i+=r[n]);return o/i}function l(r,e,t,n){if(!(Array.isArray(r)&&Array.isArray(e)&&Array.isArray(t)&&Array.isArray(n)&&r.length===e.length&&r.length===t.length&&r.length===n.length))throw new Error('invalid inputs for snp diversity score');let o=0;for(let e=0;e<r.length;e++)o+=r[e];const i=new Map;for(let e=0;e<r.length;e++){let n=i.get(t[e]);void 0===n?i.set(t[e],r[e]):i.set(t[e],n+=r[e])}const l=new Map;for(let t=0;t<r.length;t++){let n=l.get(e[t]);void 0===n?l.set(e[t],r[t]):l.set(e[t],n+=r[t])}const a=new Map;for(let e=0;e<r.length;e++){let t=a.get(n[e]);void 0===t?a.set(n[e],r[e]):a.set(n[e],t+=r[e])}let s=0;for(const[,r]of i){const e=r/o;s+=e*e}let f=0;for(const[,r]of l){const e=r/o;f+=e*e}let u=0;for(const[,r]of a){const e=r/o;u+=e*e}return 2.538684/(s=1/s)+.216729/(f=1/f)+.0575539/u}function a(r,e,t,o){if(!Array.isArray(r)||!Array.isArray(e)||!Array.isArray(t)||r.length!==e.length||r.length!==t.length)throw new Error('invalid inputs for breakeven default rate');if(!('c0'in o&&'c1'in o&&'c2'in o))throw new Error('invalid leDetails');const i=o.c1/100,l=o.c2,a=o.c0;return i*n(r,e)/100+l*n(r,t)/100+a}function s(r,e,t,o,a,s,u){if(!(Array.isArray(r)&&Array.isArray(e)&&Array.isArray(t)&&Array.isArray(o)&&Array.isArray(a)&&Array.isArray(s)&&Array.isArray(u)&&r.length===e.length&&r.length===t.length&&r.length===o.length&&r.length===a.length&&r.length===s.length&&r.length===u.length))throw new Error('invalid inputs for scenario default rate');const c=n(r,a),y=i(r,a),g=l(r,e,t,o),h=[];for(let e=0;e<r.length;e++)null===s[e]?h.push(f(new Date,new Date(u[e]))):h.push(f(new Date(s[e]),new Date(u[e])));return 1.210322*c/100-.586627*y/100+g-.013662*(n(r,h)/365)+.329915}function f(r,e){const t=r.getTime(),n=e.getTime()-t;return Math.round(n/864e5)}Object.defineProperty(e,'__esModule',{value:!0}),e.weightedAverage=n,e.weightedAverageBidOffer=function(r,e,t,n){if(!(Array.isArray(r)&&Array.isArray(e)&&Array.isArray(t)&&Array.isArray(n)&&r.length===e.length&&r.length===t.length&&r.length===n.length))throw new Error('invalid inputs for weighted average bid offer');for(let r=0;r<n.length;r++)null!==n[r]&&0!==n[r]||(n[r]=t[r]);let o=0,i=0;for(let l=0;l<r.length;l++){const a=(t[l]+n[l])/2;o+=r[l]*a;const s=e[l]-r[l];s>0?o+=s*n[l]:s<0&&(o+=s*t[l]),i+=e[l]}return o/i},e.percentCalc=function(r,e,t){if(!Array.isArray(r)||!Array.isArray(e)||r.length!==e.length||!Array.isArray(t))throw new Error('invalid inputs for percent calc');let n=0,o=0;for(let i=0;i<r.length;i++)null!==r[i]&&0!==r[i]&&(t&&t.includes(e[i])&&(n+=r[i]),o+=r[i]);return n/o*100},e.createDiversityMap=o,e.diversityScore=function(r,e,t){if(!Array.isArray(r)||!Array.isArray(e)||!Array.isArray(t)||r.length!==e.length||r.length!==t.length)throw new Error('invalid inputs for diversity score');const n=o(r,e,t);let i=0,l=0;for(const[,r]of n)for(const[,e]of r){const r=e.reduce((r,e)=>r+e,0);0!==r&&(l+=1),i+=r}const a=i/l;let s=0;for(const[,r]of n){let e=0;for(const[,t]of r){const r=t.reduce((r,e)=>r+e,0)/a;e+=r>1?1:r}let t=Math.trunc(10*(e+.05));t>=u.length&&(t=u.length-1),s+=u[t]}return s},e.dispersion=i,e.snpDiversityScore=l,e.breakevenDefaultRate=a,e.scenarioDefaultRate=s,e.cdoMonitorCushion=function(r,e,t,n,o,i,l,f,u,c){return a(r,f,u,c)-s(r,e,t,n,o,i,l)};const u=[0,.1,.2,.3,.4,.5,.6,.7,.8,.9,1,1.05,1.1,1.15,1.2,1.25,1.3,1.35,1.4,1.45,1.5,1.55,1.6,1.65,1.7,1.75,1.8,1.85,1.9,1.95,2,2.0333,2.0667,2.1,2.1333,2.1667,2.2,2.2333,2.2667,2.3,2.3333,2.3667,2.4,2.4333,2.4667,2.5,2.5333,2.5667,2.6,2.6333,2.6667,2.7,2.7333,2.7667,2.8,2.8333,2.8667,2.9,2.9333,2.9667,3,3.025,3.05,3.075,3.1,3.125,3.15,3.175,3.2,3.225,3.25,3.275,3.3,3.325,3.35,3.375,3.4,3.425,3.45,3.475,3.5,3.525,3.55,3.575,3.6,3.625,3.65,3.675,3.7,3.725,3.75,3.775,3.8,3.825,3.85,3.875,3.9,3.925,3.95,3.975,4,4.01,4.02,4.03,4.04,4.05,4.06,4.07,4.08,4.09,4.1,4.11,4.12,4.13,4.14,4.15,4.16,4.17,4.18,4.19,4.2,4.21,4.22,4.23,4.24,4.25,4.26,4.27,4.28,4.29,4.3,4.31,4.32,4.33,4.34,4.35,4.36,4.37,4.38,4.39,4.4,4.41,4.42,4.43,4.44,4.45,4.46,4.47,4.48,4.49,4.5,4.51,4.52,4.53,4.54,4.55,4.56,4.57,4.58,4.59,4.6,4.61,4.62,4.63,4.64,4.65,4.66,4.67,4.68,4.69,4.7,4.71,4.72,4.73,4.74,4.75,4.76,4.77,4.78,4.79,4.8,4.81,4.82,4.83,4.84,4.85,4.86,4.87,4.88,4.89,4.9,4.91,4.92,4.93,4.94,4.95,4.96,4.97,4.98,4.99,5]}]));");
        double[] doubleArray = new double[] { 1, 2, 3 };
        double[] intArray2 = new double[] { 1, 2, 3 };
        double res = jsBindings.getMember("exports").getMember("weightedAverage")
                .execute(ProxyArray.fromArray(toDoubleArray(doubleArray)), ProxyArray.fromArray(toDoubleArray(intArray2))).asDouble();
        System.out.println(res);
    }

    private static Double[] toDoubleArray(double[] d) {
        return Arrays.stream(d).boxed().toArray(Double[]::new);
    }
}
